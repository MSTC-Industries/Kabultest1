var allitems = {
  //"" : {"img": "", "price": 1.00 },
  "health.html" : {
    "Health Products" : {
      "Dettol" : {"img" : "Images/DettolKills99.99.png", "price" : 1.00},
      "Dus Jeli" : {"img" : "Images/DusJeli.png", "price" : 1.00},
      "Dus Jelired" : {"img" : "Images/DusJelired.png", "price" : 1.00},
      "Pantene" : {"img" : "Images/Pantene.png", "price" : 1.00},
    },
    "Oils" : {
      "Argan Oil" : {"img": "Images/arganoil.png", "price": 1.00 },
      "Alma Oil" : {"img" : "Images/almaoil.png", "price" : 1.00},
      "Baby Oil" : {"img": "Images/babyoil.png", "price": 1.00 },
    },
    "Diapers" : {
      "Alkozay" : {"img" : "Images/alkozay.png", "price" : 1.00}
    }
  },

  "kitchen.html" : {
    "Bottles" : {
      "1800ML Glass Jug" : {"img" : "Images/1800ML glass jug.jpg", "price" : 1.00},
      "Always Vacuum Flask" : {"img" : "Images/always vacuum flask.png", "price" : 1.00}
    },
    "Machines" : {
      "Ampia" : {"img": "Images/ampia.png", "price": 1.00 },
    },
    "Containers" : {
      "Anchor Hocking Glass Bakeware" : {"img": "Images/anchor hocking glass bakeware.png", "price": 1.00 },
    }
  },

  "drinks.html" : {
    "Drinks": {
      "Dill Weed": {"img": "Images/DillWeed.png", "price": 4 },
      "Ferfresh": {"img": "Images/Ferfresh.png", "price": 3.2 },
      "Hamdard": {"img": "Images/Hamdard.png", "price": 2.5 },
      "Lime Juice": {"img": "Images/LimeJuice.png", "price": 12 },
      "PWillow": {"img": "Images/PWillow.png", "price": 3 }
    },
    "Water" : {
      "Chicory Water": {"img": "Images/ChicoryWater.png", "price": 6 },
      "Cortas Blossom Water": {"img": "Images/CortasBlossomWater.png", "price": 5 },
      "Fumitory Water": {"img": "Images/FumitoryWater.png", "price": 3.3 },
      "Mint Water": {"img": "Images/Mintwater.png", "price": 3 },
    },
    "Tea": {
      "Alokozay Green Gunpowder": {"img": "Images/alokozay green gunpowder.png", "price": 3 },
      "Alokozay Green Tea": {"img": "Images/alokozay green tea.jpg", "price": 3 },
      "Alokozay Orange Pekoe": {"img": "Images/alokozay orange pekoe.jpg", "price": 3 },
      "Alwazah Tea" : {"img": "Images/alwazah tea.jpg", "price": 1.00 },
    }
  },

  "foods.html" : {
    "Meals": {
      "Almonds": {"img": "Images/Almonds.jpg", "price": 4 },
      "Basak Pudding": {"img": "Images/Basakpudding.png", "price": 3.2 },
      "Beans": {"img": "Images/beans.jpg", "price": 3.3 },
      "Tomato Soup": {"img": "Images/ThickTomatoSoup.png", "price": 3 },
      "Soup Starter": {"img": "Images/SoupStarter.png", "price": 3 },
      "Shani Haleem Mix": {"img": "Images/ShaniHaleemMix.png", "price": 3 },
      "Sadaf Giardiniera": {"img": "Images/SadafGiardiniera.png", "price": 3 },
      "Bihari Kabab": {"img": "Images/BihariKabab.png", "price": 12 },
      "Cafe Najiar": {"img": "Images/CafeNajiar.png", "price": 3 },
      "Chicken Jaffrezi": {"img": "Images/ChickenJaffrezi.png", "price": 3 },
      "Chicken Tikka": {"img": "Images/ChickenTikka.png", "price": 3 },
      "Dalbiji": {"img": "Images/dalbiji.png", "price": 3 },
      "Granulated Sugar": {"img": "Images/GranulatedSugar.png", "price": 3 },
      "Gulab Jamon": {"img": "Images/GulabJamon.png", "price": 3 },
      "Italian Mushroom Soup": {"img": "Images/ItalianMushroomsoup.png", "price": 3 },
      "Lahori Fish": {"img": "Images/LahoriFish.png", "price": 3 },
      "Malai Kofta": {"img": "Images/MalaiKofta.png", "price": 3 },
      "Meat Tenderizer": {"img": "Images/Meattenderizer.png", "price": 3 },
      "Murgh Cholay": {"img": "Images/MurghCholay.png", "price": 3 },
      "Pani Puri": {"img": "Images/PaniPuri.png", "price": 3 },
      "Moong Dal": {"img": "Images/moongdal.png", "price": 3 },
      "Organic Virgin Coconut Oil": {"img": "Images/OrganicVirginCoconutOil.png", "price": 3 },
      "Panko Plain": {"img": "Images/PankoPlain.png", "price": 3 },
      "Pasta": {"img": "Images/pasta.png", "price": 3 },
      "Pilau Biryani": {"img": "Images/PilauBiryani.png", "price": 3 },
      "Plain Salt": {"img": "Images/PlainSalt.png", "price": 3 },
      "Plain Panko Bread Crumbs": {"img": "Images/PlainPankoBreadCrumbs.png", "price": 3 },
      "Rajma Raseela": {"img": "Images/RajmaRaseela.png", "price": 3 },
      "Rasins": {"img": "Images/rasins.jpg", "price": 4 },
      "WoodWards": {"img": "Images/WoodWards.png", "price": 3 }
    },
    "Rice": {
      "Yara Egyptian Rice": {"img": "Images/YaraEgyptianRice.png", "price": 3 },
      "Aahu Bara Basmati Sela Rice": {"img": "Images/aahu bara basmati sela rice.png", "price": 3 }
    },
    "Frozen": {
      "Aloo Paratha": {"img": "Images/aloo paratha.png", "price": 3 },
      "Baklava" : {"img": "Images/baklava.png", "price": 1.00 },
    },
    "Powders" : {
      "Beef Shawarma": {"img": "Images/BeefShawarma.png", "price": 8 },
      "Amchur Powder": {"img": "Images/AmchurPowder.png", "price": 5 },
      "Chicken Kabob": {"img": "Images/ChickenKabob.png", "price": 3 },
      "Citric Acid": {"img": "Images/CitricAcid.png", "price": 3 },
      "Corn Flour": {"img": "Images/CornFlour.png", "price": 3 },
      "Ground Dried Lime": {"img": "Images/GroundDriedLime.png", "price": 3 },
      "Ground Meat Kabob": {"img": "Images/groundmeatkabob.png", "price": 3 },
      "Instant Yeast": {"img": "Images/ImportedInstantYeast.png", "price": 3 },
      "Red Chili Powder": {"img": "Images/Redchilipowder.png", "price": 3 },
    },
    "Snacks": {
      "The Ultimate Classic Cake Mix": {"img": "Images/TheUltimateclassiccakemix.png", "price": 3 },
      "Strawberry Snack Cakes": {"img": "Images/StrawberrySnackCakes.png", "price": 3 },
      "Pudra Sekeri": {"img": "Images/PudraSekeri.png", "price": 3 },
      "Kaju Mixture": {"img": "Images/kaju mixture.png", "price": 3 },
      "Pina Colada Jelly Crystals": {"img": "Images/PinaColadaJellyCrystals.png", "price": 3 },
      "Khatta Meetha": {"img": "Images/KhattaMeetha.png", "price": 3 },
      "Kamyamack Lezzdrade": {"img": "Images/KaymackLezzdrade.png", "price": 3 },
      "Milk Cakes": {"img": "Images/MilkCakes.png", "price": 3 },
      "Mango Desserts": {"img": "Images/MangoDeliciousDessertforDelightful.png", "price": 3 },
      "Maya Snacks": {"img": "Images/Maya.png", "price": 3 },
      "Blue Berry Jelly Crystals": {"img": "Images/BlueBerryJellyCrystals.png", "price": 6 },
      "Cake Rusk": {"img": "Images/CakeRusk.png", "price": 5 },
      "Cake Rusk Blue": {"img": "Images/CakeRuskBlue.png", "price": 4 },
      "Cake Rusk Red": {"img": "Images/CakeRuskRed.png", "price": 3.2 },
      "Choco&Honey Snack Cakes": {"img": "Images/Choco&honeySnackCakes.png", "price": 3.3 },
      "Cocomo": {"img": "Images/Cocomo.png", "price": 2.5 },
      "Cream Caramel": {"img": "Images/CreamCaramel.png", "price": 12 },
      "Damla Worms": {"img": "Images/DamlaWorms.png", "price": 3 },
      "Date Syrup": {"img": "Images/DateSyrup.png", "price": 3 },
      "Freekeh": {"img": "Images/Freekeh.png", "price": 3 },
      "Gold Pakmaya": {"img": "Images/GoldPakmaya.png", "price": 3 }
    }
  }
}

var totalprice = 0;
var toggle = 0;

function ready() {
  document.getElementById("searchback").style.display = "none";
}

function toggleCart() {
    const cartPanel = document.getElementById('cart-panel');
    cartPanel.classList.toggle('open');

    toggle = toggle + 1;
}

function addToCart(button) {
    const parentElement = button.parentElement;
    var cart = document.getElementById("cartItems");

    var count = getChildById(parentElement, "quantity");
    var title = getChildById(parentElement, "name");
    var multi = getChildById(parentElement, "v");

    var pv = count.value;
    var multiv = multi.getAttribute("value");

    pv = pv * multiv;
    pv = Math.round(pv*100)/100;
    totalprice = totalprice + pv;

    cart.querySelectorAll("*").forEach(function(node) {
      var text = getChildById(node, "text");
      if (text != null && text.value == title.innerText) {
        totalprice -= text.name
        node.remove();
      }
    })

    if(pv != 0){
      var name = title.innerText;
      var cartitem = document.createElement("div");
      var text = document.createElement("h2");
      var removebutton = document.createElement("button");
      var quantity = document.createElement("input");

      quantity.type = "number";
      quantity.id = "quantity";
      quantity.name = multiv;
      quantity.value = count.value;

      text.innerHTML = name + ": $"+ pv;
      text.id = "text";
      text.name = pv;
      text.value = name;

      removebutton.textContent = "remove";
      removebutton.id = "remove";

      cart.appendChild(cartitem);
      cartitem.appendChild(text);
      cartitem.appendChild(removebutton);
      cartitem.appendChild(quantity);

      quantity.addEventListener("input", () => {updateCartItem(cartitem)});

      removebutton.addEventListener("click", () => {
        cartitem.remove();
        totalprice -= text.name;
        document.getElementById("totalAmount").innerHTML = "Total: $"+totalprice;
       });
    }

    document.getElementById("totalAmount").innerHTML = "Total: $"+totalprice;
}

function updateCartItem(item) {
  var quantity = getChildById(item, "quantity");
  var newprice = quantity.name * quantity.value
  var text = getChildById(item, "text");
  text.innerHTML = text.value + ": $"+ newprice

  totalprice -= text.name
  totalprice += newprice
  text.name = newprice

  document.getElementById("totalAmount").innerHTML = "Total: $"+totalprice;
}

function loadPage(page) {
    fetch(page)
      .then(response => {
        if (!response.ok) {
          throw new Error("Page not found");
        }
        return response.text();
      })
      .then(data => {
        document.getElementById("pagestuff").innerHTML = data;

        addcards(getChildById(document.getElementById("pagestuff"), "c"), allitems[page]);
      })
      .catch(error => {
        console.error(error);
        document.getElementById("pagestuff").innerHTML = "<p>Error loading page</p>";
      });
}

function getChildById(parentElement, id) {
    const child = parentElement.querySelector(`#${id}`);
    return child;
}

function search(searchinput = document.getElementById("searchbox").value) {
  document.querySelectorAll(".card").forEach(function(node) {
    var title = getChildById(node, "name").innerText;
    if (title.toLowerCase().includes(searchinput.toLowerCase())) {
      node.style.display = "block"
    } else {
      node.style.display = "none"
    }
  
    document.getElementById("searchback").style.display = "block";
});
}

function searchback() {
  search("");
  document.getElementById("searchback").style.display = "none";
  document.getElementById("searchbox").value = "";
}

function addcards(self, items) {
  for (category in items) {
      var title = document.createElement("h1");
      title.innerHTML = category;
      var container = document.createElement("div");
      container.className = "category";

      console.log(self);

      self.appendChild(title);
      self.appendChild(container);

      for (itemkey in items[category]) {
          var item = document.createElement("div");
          item.className = "card";

          item.innerHTML = "\
              <img src='" + items[category][itemkey].img + "' alt='Food Image'>\
              <h2 id='name'>" + itemkey + "</h2>\
              <h3 value = '" + items[category][itemkey].price + "' id='v'>$" + items[category][itemkey].price + " per lb</h3>\
              <div class='quantity-selector'>\
                  <label for='quantity'>Quantity: </label>\
                  <input type='number' id='quantity' name='quantity' min='0' max='20' value='0'>\
              </div>\
              <button onclick='addToCart(this)'>Add to Cart</button>";
          container.appendChild(item);
      }
  }
}